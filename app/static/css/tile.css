/**
 * MediaTile Component Styles
 *
 * Unified styling for media tiles across all contexts:
 * - Results grid
 * - Examination carousel
 * - Preview modes
 *
 * Uses CSS custom properties for dynamic sizing.
 */

/* ============================================
   BASE TILE STYLES
   ============================================ */

.media-tile {
    --tile-size: 150px;
    --tile-radius: var(--border-radius-sm, 6px);
    --tile-border: 2px;
    --badge-size: 1.4rem;
    --badge-font: 0.7rem;
    --badge-padding: 2px 5px;
    --badge-gap: 4px;

    position: relative;
    width: var(--tile-size);
    aspect-ratio: 1;
    border: var(--tile-border) solid transparent;
    border-radius: var(--tile-radius);
    background: var(--bg-secondary, #1a1a1a);
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
}

/* Tile image */
.media-tile .tile-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.2s ease;
}

/* ============================================
   SIZE VARIANTS
   ============================================ */

/* Compact - 100px, minimal badges */
.media-tile.tile-compact {
    --tile-size: 100px;
    --badge-size: 1.1rem;
    --badge-font: 0.6rem;
    --badge-padding: 1px 4px;
    --badge-gap: 2px;
}

/* Medium - 150px, standard badges */
.media-tile.tile-medium {
    --tile-size: 150px;
}

/* Large - 200px, full badges */
.media-tile.tile-large {
    --tile-size: 200px;
    --badge-size: 1.6rem;
    --badge-font: 0.8rem;
    --badge-padding: 3px 7px;
    --badge-gap: 6px;
}

/* Full - fills container, aspect ratio preserved */
.media-tile.tile-full {
    --tile-size: auto;
    --badge-size: 1.8rem;
    --badge-font: 0.9rem;
    --badge-padding: 4px 10px;
    --badge-gap: 8px;

    width: 100%;
    height: 100%;
    aspect-ratio: auto;
}

.media-tile.tile-full .tile-image {
    object-fit: contain;
}

/* ============================================
   MODE VARIANTS
   ============================================ */

/* Grid mode - square tiles with cover fit */
.media-tile.tile-grid {
    aspect-ratio: 1;
}

.media-tile.tile-grid .tile-image {
    object-fit: cover;
}

/* Carousel mode - for examination prev/next */
.media-tile.tile-carousel {
    --tile-size: auto;
    width: 100%;
    height: 100%;
    aspect-ratio: auto;
    border: none;
    background: transparent;
}

.media-tile.tile-carousel .tile-image {
    object-fit: contain;
    max-width: 100%;
    max-height: 100%;
}

/* Preview mode - large centered image */
.media-tile.tile-preview {
    --tile-size: auto;
    width: 100%;
    height: 100%;
    aspect-ratio: auto;
    border: none;
    background: transparent;
}

.media-tile.tile-preview .tile-image {
    object-fit: contain;
    border-radius: var(--border-radius);
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
}

/* ============================================
   INTERACTIVE STATES
   ============================================ */

.media-tile:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.media-tile:hover .tile-image {
    transform: scale(1.05);
}

.media-tile.selected {
    transform: scale(1.03);
    border-color: var(--color-primary, #3b82f6);
    box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
}

.media-tile.selected::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(59, 130, 246, 0.1);
    pointer-events: none;
}

/* Duplicate group styling */
.media-tile.duplicate-group {
    --duplicate-color: hsl(45, 90%, 50%);
    --duplicate-color-light: hsla(45, 90%, 50%, 0.4);
    border-color: var(--duplicate-color);
}

.media-tile.duplicate-group:hover {
    box-shadow:
        0 0 0 3px var(--duplicate-color-light),
        0 4px 12px var(--duplicate-color-light);
}

/* Discarded state */
.media-tile.discarded {
    opacity: 0.6;
}

.media-tile.discarded .tile-image {
    filter: grayscale(50%);
}

/* ============================================
   BADGES SYSTEM
   ============================================ */

.tile-badges {
    position: absolute;
    inset: var(--badge-gap);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    pointer-events: none;
    z-index: 2;
}

.badge-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.badge-row.badge-bottom {
    align-items: flex-end;
}

.badge-group {
    display: flex;
    gap: var(--badge-gap);
    pointer-events: auto;
}

.badge-group.badge-right {
    flex-direction: row-reverse;
}

/* Individual badge styles */
.tile-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: var(--badge-size);
    height: var(--badge-size);
    padding: var(--badge-padding);
    border-radius: 4px;
    font-size: var(--badge-font);
    font-weight: 600;
    line-height: 1;
    color: white;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    transition: transform 0.15s ease, opacity 0.15s ease;
}

/* Confidence badges */
.tile-badge.confidence-high {
    background: var(--color-high, #22c55e);
}

.tile-badge.confidence-medium {
    background: var(--color-medium, #f59e0b);
    color: #000;
    text-shadow: none;
}

.tile-badge.confidence-low {
    background: var(--color-low, #ef4444);
}

.tile-badge.confidence-none {
    background: var(--color-text-muted, #6b7280);
}

/* Status badges */
.tile-badge.reviewed {
    background: var(--color-high, #22c55e);
}

.tile-badge.failed {
    background: var(--color-low, #ef4444);
}

.tile-badge.discarded {
    background: var(--color-danger, #dc2626);
}

.tile-badge.duplicate {
    background: var(--duplicate-color, hsl(45, 90%, 50%));
    color: #000;
    text-shadow: none;
}

.tile-badge.media-video {
    background: var(--color-info, #3b82f6);
}

/* Badge hover effects */
.media-tile:hover .tile-badge {
    transform: scale(1.05);
}

/* ============================================
   CHECKBOX
   ============================================ */

.tile-checkbox {
    display: flex;
    align-items: center;
    justify-content: center;
    width: var(--badge-size);
    height: var(--badge-size);
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.15s ease;
}

.media-tile:hover .tile-checkbox,
.media-tile.selected .tile-checkbox {
    opacity: 1;
}

.tile-checkbox input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
}

.tile-checkbox .checkmark {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    border: 2px solid rgba(255, 255, 255, 0.5);
    border-radius: 4px;
    transition: all 0.15s ease;
}

.tile-checkbox .checkmark::after {
    content: '';
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg) scale(0);
    transition: transform 0.15s ease;
}

.tile-checkbox input:checked ~ .checkmark {
    background: var(--color-primary, #3b82f6);
    border-color: var(--color-primary, #3b82f6);
}

.tile-checkbox input:checked ~ .checkmark::after {
    transform: rotate(45deg) scale(1);
}

/* ============================================
   FILENAME OVERLAY
   ============================================ */

.tile-filename {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: var(--badge-gap) calc(var(--badge-gap) * 1.5);
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    color: white;
    font-size: var(--badge-font);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    opacity: 0;
    transform: translateY(100%);
    transition: opacity 0.2s ease, transform 0.2s ease;
}

.media-tile:hover .tile-filename,
.media-tile.selected .tile-filename {
    opacity: 1;
    transform: translateY(0);
}

/* Always show filename in preview mode */
.media-tile.tile-preview .tile-filename {
    opacity: 1;
    transform: translateY(0);
}

/* ============================================
   CAROUSEL-SPECIFIC ANIMATIONS
   ============================================ */

/* Side tiles in carousel (prev/next) - slightly dimmed */
.carousel-tile.tile-prev,
.carousel-tile.tile-next {
    opacity: 0.7;
}

.carousel-tile.tile-prev:hover,
.carousel-tile.tile-next:hover {
    opacity: 0.9;
}

/* Hide badges on side carousel tiles */
.carousel-tile.tile-prev .tile-badges,
.carousel-tile.tile-next .tile-badges {
    display: none;
}

/* Center tile in carousel - full visibility */
.carousel-tile.tile-center {
    opacity: 1;
}

/* ============================================
   MIPMAP RESOLUTION TRANSITIONS
   ============================================ */

/* Smooth image source transitions */
.tile-image {
    transition: opacity 0.2s ease;
}

.tile-image-fade {
    opacity: 0.7;
}

/* High-res indicator (optional debug) */
.thumbnail[data-resolution="full"] .tile-image {
    /* Visual indicator that full-res is loaded */
}

/* ============================================
   VIEWPORT POSITION STATES
   ============================================ */

/* Base transition for active viewport positions (not grid) */
.thumbnail[data-vp-pos="prev"],
.thumbnail[data-vp-pos="current"],
.thumbnail[data-vp-pos="next"] {
    transition:
        transform 0.35s cubic-bezier(0.4, 0, 0.2, 1),
        opacity 0.35s ease,
        width 0.35s ease,
        height 0.35s ease,
        left 0.35s ease;
}

/* Grid position (default) */
.thumbnail.vp-grid,
.thumbnail:not([data-vp-pos]) {
    /* Normal grid behavior - no special positioning */
}

/* Hidden position */
.thumbnail.vp-hidden,
.thumbnail[data-vp-pos="hidden"] {
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
}

/* Previous tile in viewport */
.thumbnail.vp-prev,
.thumbnail[data-vp-pos="prev"] {
    opacity: 0.7;
    cursor: pointer;
}

.thumbnail.vp-prev:hover,
.thumbnail[data-vp-pos="prev"]:hover {
    opacity: 0.85;
}

/* Current (center) tile in viewport */
.thumbnail.vp-current,
.thumbnail[data-vp-pos="current"] {
    opacity: 1;
    z-index: 10;
}

/* Next tile in viewport */
.thumbnail.vp-next,
.thumbnail[data-vp-pos="next"] {
    opacity: 0.7;
    cursor: pointer;
}

.thumbnail.vp-next:hover,
.thumbnail[data-vp-pos="next"]:hover {
    opacity: 0.85;
}

/* Hide badges on side tiles in viewport mode */
.thumbnail.vp-prev .thumbnail-badges,
.thumbnail.vp-next .thumbnail-badges,
.thumbnail[data-vp-pos="prev"] .thumbnail-badges,
.thumbnail[data-vp-pos="next"] .thumbnail-badges {
    opacity: 0;
}

/* Scale-aware badge visibility in viewport */
.thumbnail.vp-current .thumbnail-badges,
.thumbnail[data-vp-pos="current"] .thumbnail-badges {
    opacity: 1;
}

/* ============================================
   RESPONSIVE SCALING
   ============================================ */

@media (max-width: 768px) {
    .media-tile {
        --badge-size: 1.2rem;
        --badge-font: 0.65rem;
        --badge-padding: 2px 4px;
        --badge-gap: 3px;
    }

    .media-tile.tile-large {
        --tile-size: 150px;
    }

    .tile-filename {
        font-size: 0.7rem;
    }
}
