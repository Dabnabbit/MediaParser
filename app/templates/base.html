<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MediaParser{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tile.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/viewport.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/examination.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/timeline.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tags.css') }}">
    {% block extra_css %}{% endblock %}
    <!-- Theme must load early (no defer) to prevent flash of wrong theme -->
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
</head>
<body>
    <header class="app-header">
        <div class="container">
            <div class="app-header-left">
                <h1 class="app-title">MediaParser</h1>
                <p class="app-subtitle">Organize your family media archive</p>
            </div>
            <button type="button" class="settings-gear-btn" id="settings-gear-btn" title="Settings" aria-label="Open settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>
        </div>
    </header>

    <main class="app-main">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Modal system (must load before other JS that calls showModal/showToast) -->
    <script src="{{ url_for('static', filename='js/modal.js') }}" defer></script>
    <!-- Core JavaScript modules -->
    <script src="{{ url_for('static', filename='js/settings.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/upload.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/progress.js') }}" defer></script>
    <!-- Tile system (must load before results.js) -->
    <script src="{{ url_for('static', filename='js/tile.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/virtual-scroll.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/tile-manager.js') }}" defer></script>
    <!-- Viewport controller (split for maintainability) -->
    <script src="{{ url_for('static', filename='js/viewport-core.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/viewport-animation.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/viewport-navigation.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/viewport-ui.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/viewport-compare.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/viewport-video.js') }}" defer></script>
    <!-- Particle effects (universal, no dependencies) -->
    <script src="{{ url_for('static', filename='js/particles.js') }}" defer></script>
    <!-- Grid and filtering -->
    <script src="{{ url_for('static', filename='js/filters.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/results.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/slider.js') }}" defer></script>
    <!-- Selection handler (split for maintainability) -->
    <script src="{{ url_for('static', filename='js/selection-core.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/selection-events.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/selection-actions.js') }}" defer></script>
    <!-- Viewport details (depends on ViewportController) -->
    <script src="{{ url_for('static', filename='js/viewport-details.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/examination.js') }}" defer></script>
    <!-- Timestamp and tags -->
    <script src="{{ url_for('static', filename='js/vendor/chrono.min.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/timestamp.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/tags.js') }}" defer></script>
    <!-- Viewport debug toolkit (no-op until called from console) -->
    <script src="{{ url_for('static', filename='js/debug-viewport.js') }}" defer></script>
    {% block extra_js %}{% endblock %}

    <!-- Settings Drawer -->
    <div class="settings-drawer-backdrop" id="settings-drawer-backdrop"></div>
    <aside class="settings-drawer" id="settings-drawer" role="dialog" aria-label="Settings">
        <div class="settings-drawer-header">
            <h2 class="settings-drawer-title">Settings</h2>
            <button type="button" class="settings-drawer-close" id="settings-drawer-close" aria-label="Close settings">&times;</button>
        </div>
        <div class="settings-drawer-body">
            <div class="settings-form">
                <div class="settings-row">
                    <div class="form-group form-group-sm">
                        <label for="theme-select" class="form-label">Theme</label>
                        <select id="theme-select" class="form-input form-select-sm">
                            <option value="system">System</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                    <div class="form-group form-group-sm form-group-grow">
                        <label for="output-directory" class="form-label">Output Directory</label>
                        <div class="input-group input-group-sm">
                            <input type="text" id="output-directory" class="form-input" placeholder="/path/to/output">
                            <button type="button" class="btn btn-secondary btn-sm" id="reset-output-dir-btn" title="Reset">&#x21BA;</button>
                        </div>
                    </div>
                </div>
                <div class="form-actions-inline">
                    <button type="button" class="btn btn-primary btn-sm" id="save-settings-btn">Save</button>
                    <span class="settings-status" id="settings-status"></span>
                </div>
                <div class="settings-error" id="settings-error" style="display: none;">
                    <span id="settings-error-text"></span>
                </div>
                <label class="settings-toggle-label" for="strict-workflow-toggle">
                    <input type="checkbox" id="strict-workflow-toggle">
                    <span>Strict workflow progression</span>
                    <span class="settings-toggle-hint">Lock stages until prior ones are resolved</span>
                </label>
            </div>

            <!-- Debug Section (only shown in debug mode) -->
            <div class="debug-section" id="debug-section" style="display: none;">
                <div class="debug-header">
                    <span class="debug-title">Debug Tools</span>
                    <span class="debug-warning">Development Only</span>
                </div>
                <div class="debug-info">
                    <div class="debug-stat">
                        <span class="debug-label">Database:</span>
                        <span class="debug-value" id="db-size">-</span>
                    </div>
                    <div class="debug-stat">
                        <span class="debug-label">Tables:</span>
                        <span class="debug-value" id="db-tables">-</span>
                    </div>
                    <div class="debug-stat">
                        <span class="debug-label">Storage:</span>
                        <span class="debug-value" id="storage-size">-</span>
                    </div>
                </div>
                <div class="debug-actions">
                    <button type="button" class="btn btn-secondary btn-sm" id="clear-db-btn">Clear Database</button>
                    <button type="button" class="btn btn-secondary btn-sm" id="clear-storage-btn">Clear Storage</button>
                    <button type="button" class="btn btn-danger btn-sm" id="clear-all-btn">Clear All</button>
                </div>
            </div>
        </div>
    </aside>
</body>
</html>
