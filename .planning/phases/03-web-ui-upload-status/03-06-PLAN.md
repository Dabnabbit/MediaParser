---
phase: 03-web-ui-upload-status
plan: 06
type: execute
wave: 4
depends_on: ["03-04", "03-05"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can upload files via drag-drop"
    - "User can upload folder via folder picker"
    - "User sees real-time progress during processing"
    - "User can pause and resume processing"
    - "User sees results grouped by confidence"
    - "Thumbnails display correctly (not rotated)"
---

<objective>
Verify the complete Phase 3 web UI implementation with user testing.

Purpose: Ensures all components work together correctly and the user experience meets requirements. This is the final verification before marking Phase 3 complete.

Output: Verified working web UI ready for Phase 4 review actions
</objective>

<execution_context>
@/home/dab/.claude/get-shit-done/workflows/execute-plan.md
@/home/dab/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-web-ui-upload-status/03-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Start application and verify endpoints</name>
  <files></files>
  <action>
Start the Flask development server and Huey worker, then verify all endpoints respond correctly:

1. **Start Flask app:**
```bash
cd /mnt/d/Work/Scripts/MediaParser
FLASK_APP=run.py FLASK_ENV=development flask run --host=0.0.0.0 --port=5000 &
```

2. **Start Huey worker:**
```bash
huey_consumer huey_config.huey -w 2 -k thread &
```

3. **Verify endpoints:**
```bash
# Main page loads
curl -s http://localhost:5000/ | head -20

# API endpoints exist
curl -s http://localhost:5000/api/current-job
curl -s http://localhost:5000/api/progress/1
```

4. **Verify static files serve:**
```bash
curl -s -I http://localhost:5000/static/css/main.css
curl -s -I http://localhost:5000/static/js/upload.js
curl -s -I http://localhost:5000/static/js/progress.js
curl -s -I http://localhost:5000/static/js/results.js
```
  </action>
  <verify>
    curl -s http://localhost:5000/ | grep -q "MediaParser" && echo "Main page OK"
  </verify>
  <done>
    - Flask app starts without errors
    - Main page renders with MediaParser title
    - All static files accessible
    - API endpoints respond (even if with 404 for non-existent jobs)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 3 Web UI with:
- Single-pane layout with upload, progress, and results sections
- Drag-drop file upload with folder picker support
- Server path import for NAS/external drives
- Real-time progress display with pause/cancel controls
- Results grouped by confidence buckets (accordion style)
- Duplicate groups with side-by-side comparison
- Thumbnail grid with size toggle
- Multi-select capability for future batch operations
  </what-built>
  <how-to-verify>
**Setup:**
1. Ensure Flask app is running: `flask run --port 5000`
2. Ensure Huey worker is running: `huey_consumer huey_config.huey -w 2 -k thread`
3. Prepare 5-10 test images (mix of portrait/landscape, different sizes)

**Test 1: Upload via Drag-Drop**
1. Open http://localhost:5000 in browser (Firefox or Chrome)
2. Drag image files onto the upload area
3. Verify: Upload progress bar appears and completes
4. Verify: Processing starts (progress section appears)

**Test 2: Upload via Folder Picker**
1. Click "Select Folder" button
2. Select a folder containing images
3. Verify: All images in folder are uploaded
4. Verify: Processing starts

**Test 3: Server Path Import (if applicable)**
1. Enter a server path in the text field (e.g., /path/to/photos)
2. Click "Import from path"
3. Verify: Files are found and processing starts

**Test 4: Progress Display**
1. During processing, verify:
   - Progress bar updates
   - File count shows (e.g., "3 / 10 files")
   - Current filename displays
   - Elapsed time updates
   - ETA displays (after a few files)
2. Click "Pause" - verify processing pauses
3. Click "Resume" - verify processing continues
4. (Optional) Click "Cancel" to test cancellation

**Test 5: Results Display**
1. After processing completes, verify:
   - Summary card shows counts
   - Confidence buckets appear (HIGH/MEDIUM/LOW)
   - Click a bucket to expand it
   - Verify only one bucket is open at a time
   - Thumbnails display correctly (not rotated!)
2. Toggle thumbnail size (compact/medium/large)
3. Click checkbox on one thumbnail, then shift-click another
   - Verify range is selected

**Test 6: Session Resume**
1. While a job is processing, refresh the page
2. Verify: Progress section reappears with current job
3. Verify: Progress continues from where it was

**Test 7: Duplicate Groups (if duplicates exist)**
1. Upload some duplicate files (same image copied)
2. After processing, verify duplicate groups appear
3. Verify "Recommended" badge shows on best version

**Browser Compatibility:**
- Test in Firefox
- Test in Chrome
- Verify layout and functionality work in both
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass, or describe any issues found.

Common issues to check:
- Thumbnails rotated (EXIF orientation not applied)
- Progress not updating (polling or API issue)
- Buckets not collapsing (JavaScript issue)
- Upload fails (API or file handling issue)
  </resume-signal>
</task>

</tasks>

<verification>
All verification happens in the human-verify checkpoint above.
</verification>

<success_criteria>
- User can upload files via all three methods (drag-drop, folder picker, server path)
- Progress displays and updates during processing
- Pause/cancel/resume controls work
- Results display with confidence buckets
- Thumbnails are correctly oriented
- Multi-select works with shift-click
- Session resume works on page refresh
- Works in both Firefox and Chrome
</success_criteria>

<output>
After completion, create `.planning/phases/03-web-ui-upload-status/03-06-SUMMARY.md`

This summary should document:
- Test results from human verification
- Any issues found and how they were resolved
- Browser compatibility notes
- Phase 3 completion status
</output>
