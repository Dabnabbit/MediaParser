---
phase: 05-duplicate-detection---exact
plan: 05
type: execute
wave: 4
depends_on: ["05-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can visually compare duplicate files side-by-side"
    - "Quality metrics (resolution, size) displayed for each file"
    - "Radio button selection works correctly per group"
    - "Bulk confirm shows accurate summary before execution"
    - "Resolved duplicates removed from duplicates mode"
  artifacts: []
  key_links: []
---

<objective>
Human verification of the complete duplicate detection and resolution workflow to ensure usability and correctness before marking Phase 5 complete.

Purpose: Validate that the duplicate resolution workflow meets user needs and functions correctly
Output: Verified working duplicate detection phase
</objective>

<execution_context>
@/home/dab/.claude/get-shit-done/workflows/execute-plan.md
@/home/dab/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-duplicate-detection---exact/05-04-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete duplicate detection and resolution workflow:
1. Enhanced API with quality metrics (resolution, file size, format)
2. Card-based comparison UI with side-by-side file display
3. Radio button selection with KEEP/DISCARD badges
4. Recommended file highlighting based on quality
5. Keep All and per-group confirm functionality
6. Bulk confirmation modal with summary
7. Mode filter integration
  </what-built>
  <how-to-verify>
**Prerequisites:**
1. Ensure Flask server running: `cd /home/dab/Projects/MediaParser && .venv/bin/flask run --debug`
2. Ensure Huey worker running: `.venv/bin/huey_consumer huey_config.huey -w 2 -k thread`
3. Upload a set of files that includes duplicates (same file copied with different names)

**Test Steps:**

1. **API Verification:**
   - Process files that include exact duplicates
   - Check API response: `curl http://localhost:5000/api/jobs/1/duplicates | jq`
   - Verify response includes: width, height, resolution_mp, format, recommended_id

2. **Mode Switching:**
   - Click "Duplicates" mode chip
   - Verify grid view hides and duplicate groups appear
   - Click "Unreviewed" mode chip
   - Verify duplicate groups hide and grid returns
   - Click back to "Duplicates"

3. **Card Layout:**
   - Verify each group shows as a card with header and file comparison
   - Verify recommended file has green highlight/border
   - Verify quality metrics displayed: resolution, file size, format
   - Verify thumbnails load correctly

4. **Selection Behavior:**
   - Click radio button on non-recommended file
   - Verify KEEP badge moves to selected file
   - Verify DISCARD badges appear on other files
   - Verify recommended file can be re-selected
   - Test multiple groups - selections should be independent

5. **Keep All:**
   - Click "Keep All" on one group
   - Verify group disappears from list
   - Verify files no longer show as duplicates in grid view
   - Check database: `sqlite3 instance/mediaparser.db "SELECT id, duplicate_group_id FROM files WHERE id IN (...)"`

6. **Single Group Confirm:**
   - Make selection in one group
   - Click "Confirm Selection" for that group
   - Verify non-selected files marked as discarded
   - Verify discarded files have "discarded" badge in grid view

7. **Bulk Confirmation:**
   - Create selections for ALL remaining groups
   - Click "Confirm All Selections" button
   - Verify modal shows with correct counts:
     - Number of groups
     - Number of files to keep
     - Number of files to discard
   - Click "Cancel" - verify modal closes, no changes made
   - Click "Confirm All Selections" again
   - Click "Confirm Discards" - verify execution
   - Verify duplicate groups removed
   - Verify mode auto-switches to Unreviewed if no duplicates remain

8. **Dark Mode:**
   - Toggle to dark mode via settings
   - Verify all duplicate UI elements styled correctly
   - Verify contrast is readable

9. **Filter Count Updates:**
   - After resolution, verify mode counts updated:
     - Duplicates count reduced
     - Discarded count increased
     - Total remains same

**Expected Issues (minor, log for future):**
- None expected

  </how-to-verify>
  <resume-signal>
Type "approved" if workflow functions correctly, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Human has verified:
- [ ] Duplicate groups display correctly with quality metrics
- [ ] Radio selection works per-group without interference
- [ ] Recommended file highlighted appropriately
- [ ] Keep All removes group from duplicate detection
- [ ] Single group confirm discards non-selected files
- [ ] Bulk confirm shows accurate summary
- [ ] Modal requires explicit confirmation
- [ ] Mode counts update after resolution
- [ ] Dark mode displays correctly
- [ ] No JavaScript errors in console
</verification>

<success_criteria>
User confirms the duplicate detection workflow is:
- Intuitive and easy to understand
- Visually clear about which files will be kept vs discarded
- Safe with proper confirmation before any discards
- Functional across all test scenarios
</success_criteria>

<output>
After completion, create `.planning/phases/05-duplicate-detection---exact/05-05-SUMMARY.md`
</output>
