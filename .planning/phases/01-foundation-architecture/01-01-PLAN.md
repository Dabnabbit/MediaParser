---
phase: 01-foundation-architecture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/__init__.py
  - app/config.py
  - config.py
  - requirements.txt
  - .env.example
  - storage/.gitkeep
  - instance/.gitkeep
autonomous: true

must_haves:
  truths:
    - "Application can be configured via environment variables"
    - "Timezone is configurable, not hardcoded"
    - "File paths use pathlib.Path, not string concatenation"
    - "Storage directories exist for uploads, processing, output"
  artifacts:
    - path: "config.py"
      provides: "Configuration classes with pathlib paths"
      contains: "class Config"
    - path: "app/__init__.py"
      provides: "Application factory create_app()"
      contains: "def create_app"
    - path: ".env.example"
      provides: "Environment variable documentation"
      contains: "TIMEZONE"
    - path: "requirements.txt"
      provides: "Python dependencies"
      contains: "flask"
  key_links:
    - from: "app/__init__.py"
      to: "config.py"
      via: "app.config.from_object"
      pattern: "from_object.*config"
---

<objective>
Create Flask application scaffold with configuration management, pathlib-based paths, and configurable timezone handling.

Purpose: Establishes the foundational project structure and configuration patterns that all other components depend on. Addresses INFRA-04 (hardcoded timezone) and INFRA-05 (hardcoded paths) at the infrastructure level.

Output: Working Flask application factory, configuration system, and storage directory structure.
</objective>

<execution_context>
@/home/dab/.claude/get-shit-done/workflows/execute-plan.md
@/home/dab/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-architecture/01-RESEARCH.md
@PhotoTimeFixer.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project structure and configuration system</name>
  <files>
    config.py
    app/__init__.py
    app/config.py
    requirements.txt
    .env.example
  </files>
  <action>
Create the Flask application scaffold following the structure from RESEARCH.md:

1. **config.py** (project root):
   - Import pathlib.Path and os
   - Define BASE_DIR, INSTANCE_DIR, STORAGE_DIR using Path(__file__).parent.absolute()
   - Create Config base class with:
     - SECRET_KEY from env with dev default
     - SQLALCHEMY_DATABASE_URI pointing to instance/mediaparser.db
     - SQLALCHEMY_ENGINE_OPTIONS with check_same_thread=False, timeout=5.0
     - SQLALCHEMY_TRACK_MODIFICATIONS = False
     - UPLOAD_FOLDER, PROCESSING_FOLDER, OUTPUT_FOLDER using STORAGE_DIR / subdir
     - TIMEZONE from env, default 'America/New_York' (replacing hardcoded -4)
   - Create DevelopmentConfig(Config) with DEBUG=True, SQLALCHEMY_ECHO=True
   - Create ProductionConfig(Config) with DEBUG=False

2. **app/__init__.py**:
   - Import Flask, SQLAlchemy from flask_sqlalchemy
   - Import DeclarativeBase from sqlalchemy.orm
   - Create Base class extending DeclarativeBase
   - Create db = SQLAlchemy(model_class=Base)
   - Define create_app(config_name='development') function:
     - Create Flask app with instance_relative_config=True
     - Load config from config module based on config_name
     - Initialize db with app
     - Return app

3. **app/config.py**: Empty __init__ marker (the config is at root level, this is just to make app a package)
   Actually, skip this - app/__init__.py is the package init.

4. **requirements.txt**:
   - flask>=3.1.0
   - flask-sqlalchemy>=3.1.0
   - sqlalchemy>=2.0.0
   - huey>=2.6.0
   - python-dotenv>=1.0.0
   - tzdata
   - pyexiftool (already used by existing code)
   - pillow (already used by existing code)

5. **.env.example**:
   - FLASK_APP=app
   - FLASK_ENV=development
   - SECRET_KEY=change-me-in-production
   - TIMEZONE=America/New_York
   - Comment explaining each variable

**Important:** Use zoneinfo for timezone validation in config (import check), not pytz.
  </action>
  <verify>
    python -c "from app import create_app; app = create_app(); print('Config OK:', app.config['TIMEZONE'])"
  </verify>
  <done>
    - Config classes exist with pathlib.Path for all file paths
    - TIMEZONE is configurable via environment variable
    - create_app() returns configured Flask application
    - No hardcoded paths in configuration
  </done>
</task>

<task type="auto">
  <name>Task 2: Create storage directory structure</name>
  <files>
    storage/uploads/.gitkeep
    storage/processing/.gitkeep
    storage/output/.gitkeep
    instance/.gitkeep
  </files>
  <action>
Create the file storage directory structure:

1. Create directories:
   - storage/uploads/ - for user-uploaded original files
   - storage/processing/ - for temporary processing workspace
   - storage/output/ - for processed files organized by year
   - instance/ - for instance-specific files (database, local config)

2. Add .gitkeep files to each directory so they're tracked by git but contents are ignored.

3. Update or create .gitignore in project root to:
   - Ignore instance/*.db (database files)
   - Ignore instance/config.py (local config overrides)
   - Ignore storage/uploads/* (but keep directory)
   - Ignore storage/processing/* (but keep directory)
   - Ignore storage/output/* (but keep directory)
   - Keep .gitkeep files (!**/.gitkeep)
   - Ignore .env (but not .env.example)
   - Ignore __pycache__/, *.pyc
   - Ignore .venv/, venv/

4. Add a startup check to app/__init__.py that creates storage directories if they don't exist:
   ```python
   def ensure_directories(app):
       for folder in ['UPLOAD_FOLDER', 'PROCESSING_FOLDER', 'OUTPUT_FOLDER']:
           path = app.config[folder]
           path.mkdir(parents=True, exist_ok=True)
   ```
   Call this in create_app() after loading config.
  </action>
  <verify>
    ls -la storage/uploads storage/processing storage/output instance
    python -c "from app import create_app; create_app()"
    ls -la storage/uploads storage/processing storage/output instance
  </verify>
  <done>
    - All storage directories exist
    - .gitkeep files present in each
    - .gitignore configured to ignore contents but keep structure
    - create_app() automatically creates directories if missing
  </done>
</task>

</tasks>

<verification>
1. Run `python -c "from app import create_app; app = create_app(); print(app.config['TIMEZONE'], app.config['UPLOAD_FOLDER'])"` - should output timezone and pathlib.Path
2. Run `ls storage/*/` - should show .gitkeep in each
3. Verify no hardcoded paths exist: `grep -r "D:/Work" . --include="*.py"` - should return nothing in new files
4. Verify timezone is not hardcoded: `grep -r "timezone_hours = -4" . --include="*.py"` - should only match PhotoTimeFixer.py (original, not yet refactored)
</verification>

<success_criteria>
- Flask application factory pattern implemented
- Configuration uses pathlib.Path for all file paths
- Timezone configurable via TIMEZONE environment variable (default America/New_York)
- Storage directories created automatically on app startup
- requirements.txt lists all dependencies for Phase 1
- No hardcoded Windows paths in new code
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-architecture/01-01-SUMMARY.md`
</output>
